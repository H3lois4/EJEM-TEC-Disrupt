{% extends "base.html" %}
{% load static %}

{% block title %}Gerenciamento de Projetos - Disrupt CT{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'projetos/css/projetos.css' %}">
{% endblock %}

{% block content %}
    
    <header class="header-interno">
        <h1>GERENCIAMENTO DOS PROJETOS</h1>
    </header>

    <section>
        <h2>DREXUS</h2>
        <div class="cards">
            {% for projeto in projetos_drexus %}
            <div class="card">
                <div class="card-header">{{ projeto.nome }}</div>
                <div>
                    <p class="card-text">{{ projeto.descricao }}</p>
                    <p class="nota">[Nota: {{ projeto.nota_final|floatformat:2 }}]</p>
                    <p class="nota">[Resultado: {{ projeto.diagnostico}}]</p>
                    
                    {# ✅ CORREÇÃO 1: Adicionado o namespace 'projetos:' e a verificação de segurança #}
                    {% if projeto.id %}
                        <a href="{% url 'projetos:resultado' projeto.id %}" class="btn add-card">Acessar DREXUS</a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
            <div class="card add-card">
                {# ✅ CORREÇÃO 2: Adicionado o namespace 'projetos:' #}
                <a href="{% url 'projetos:formulario' %}">Adicionar projeto +</a>
            </div>
        </div>
    </section>

    <section>
        <h2>PROJETOS EM ANDAMENTO</h2>
        <div class="cards">
            {% for projeto in projetos_andamento %}
            <div class="card">
                <div class="card-header">{{ projeto.nome }}</div>
                <div class="card-body">
                    <p>{{ projeto.descricao }}</p>
                    <p class="nota">[N%]</p>
                    
                    {# ✅ CORREÇÃO 3: Adicionado o namespace 'projetos:' e a verificação #}
                    {% if projeto.id %}
                        <a href="{% url 'projetos:detalhe_projeto' projeto.id %}" class="btn add-card">Acessar Projeto</a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
            <div class="card add-card">
                {# ✅ CORREÇÃO 4: Adicionado o namespace 'projetos:' #}
                <a href="{% url 'projetos:criar_projeto' %}">Adicionar projeto +</a>
            </div>
        </div>
    </section>

    <section>
        <h2>PROJETOS FINALIZADOS</h2>
        <div class="cards">
            {% for projeto in projetos_finalizados %}
            <div class="card">
                <div class="card-header">{{ projeto.nome }}</div>
                <div class="card-body">
                    <p>{{ projeto.descricao }}</p>

                    {# ✅ CORREÇÃO 5: Adicionado o namespace 'projetos:' e a verificação #}
                    {% if projeto.id %}
                        <a href="{% url 'projetos:detalhe_projeto' projeto.id %}" class="btn add-card">Acessar Projeto</a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

{% endblock %}